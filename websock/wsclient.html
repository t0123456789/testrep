
<!doctype html>

<html lang="en">
<head>
<meta charset="utf-8">
</head>

<body>

<button onclick="wsCtor('ws://localhost:8080')">Click to test local svr</button>
<button onclick="wsCtor('wss://echo.websocket.org/')">Click to test external echo svr</button>
<button onclick="wsCtor('wss://vaulted-spangled-tulip.glitch.me')">Click to test glitch svr</button>

<script>

	window.onload = function() {	  				  
			  wsCtor();
			}

	var wsc = {
		nmsg: 0,
		};
			
	function wsCtor(uri) {
		if(!WebSocket) {
			var msg = "WebSocket api not supported.";
			console.log(msg);
			display(msg, "debug");
			return;
		}
		
		if(uri){
			// recreate WebSocket connection.
			var msg = "";
			if(wsc.socket){		
				console.log('Close WebSocket object...');
				msg+="Close WebSocket object...";
				display(msg, "debug");
				wsc.socket.close(1000, "Resetting socket... disconnection.");
			}
			wsc.socket = new WebSocket(uri);
			console.log('Reset WebSocket object to ', uri);
			msg+='Reset WebSocket object to '+ uri;
			display(msg, "debug");
			
		} else {		
			// Create WebSocket connection.
			var localUri = "ws://localhost:8080";
			var testUri = "wss://echo.websocket.org/";
			var glitchUri = "wss://vaulted-spangled-tulip.glitch.me";
			wsc.socket = new WebSocket(glitchUri);
			//wsc.socket = new WebSocket(localUri);
			// wss://, that indicates you want a secure websocket connection, an insecure WebSocket connection may not be initiated from a page loaded over HTTPS in some browsers
			//https://vaulted-spangled-tulip.glitch.me
		}

		if(!wsc.socket) {
			var msg = 'WebSocket object create failed.';
			console.log(msg);
			display(msg, "debug1");
			return;
		}

		// Connection opened
		wsc.socket.addEventListener('open', function (event) {
			wsc.socket.send('Hello Server from wsCtor!');
			var msg = "WebSocket open: event,protocol: "+event+","+wsc.socket.protocol;
			display(msg, "debug2");
			console.log(msg);
		});

		// Listen for messages
		wsc.socket.addEventListener('message', function (event) {
			wsc.nmsg++;
			console.log('Message from server ', event.data);
			var msg = "Message from server ("+wsc.nmsg+"): "+ event.data;
			display(msg, "debug3");
		});	
		
		wsc.socket.onerror = function(event) {
			var msg = "WebSocket error observed: "+event;
			console.log(msg);
			display(msg, "debug4");
		};
		
		wsc.socket.onclose = function(event) {
			var msg = "WebSocket is closed now: "+event;
			console.log(msg);
			display(msg, "debug5");
		};
	}

	function display(msg, elemId) {
		if(document.body) {				
			var p = document.getElementById(elemId);
			if(p){
				p.innerHTML = msg;
			} else {
				p = document.createElement('p');
				p.setAttribute("id", elemId);
				p.innerHTML = msg;
				document.body.appendChild(p);
			}
		}else{
			msg += ' document.body is null atm.';
			console.log(msg);
		}
	}
	
	function httpReqCtor() {
		// Create a request variable and assign a new XMLHttpRequest object to it.
		var request = new XMLHttpRequest();

		// Open a new connection, using the GET request on the URL endpoint
		request.open('GET', 'https://ghibliapi.herokuapp.com/films', true);
		
		request.onload = function () {
			// Begin accessing JSON data here	
			var data = JSON.parse(this.response);
			
			if (request.status >= 200 && request.status < 400) {
				console.log('ok')
			  //data.forEach((movie) => {
			//	console.log(movie.title)
			  //})
			} else {
			  console.log('error')
			}
		}

		// Send request
		request.send();
	}

	
</script>

</body>

</html>
